

{% extends 'core/base.html' %}
{% load static %}
{% load dict_extras %}  {# custom template filter we‚Äôll add below #}
{% block extra_css %}
<link rel="stylesheet" href="{% static '/css/developer_trainee_exam.css' %}">
{% endblock %}

{% block content %}
 <div class="admin-dashboard-header">
  <!-- Part 1: Greeting -->
  <div class="greeting">
    <div style="display: flex; gap: 10px;">
    <!-- <img src="{{trainee.user.profile_image.url }}" alt="User image" title="{{ request.user.full_name }}"/> -->
    <div style="margin-top: 20px;">
      <h3>{{ greeting }}!!!</h3>
  <p>It's {{ today|date:"l, d F Y" }}</p>


    </div>
    </div>
  </div>

 
  <!-- Part 3: Notification & Login -->
  <div class="icon-group">
    <!-- <div class="notification-icon">
      <img src="{% static 'images/notifi.jpg' %}" alt="Notifications" />
      <span class="badge">3</span>
    </div> -->
    <div class="login-icon">
      <a href="{% url 'admin_logout' %}">
      <img src="{% static 'images/logout.jpeg' %}" alt="User Login" title="logout"/>
      </a>
    </div>
  </div>
</div>

<div class="recent-exams-section">
  <div class="exam-box">
    <div class="section-title-bar">
      <h4>Technical  Exams</h4>
    </div>
{% if exams %}
    {% for exam in exams %}
        <div class="exam-row">
            <div class="exam-info">
                <p class="exam-title">{{ exam.title }}</p>
                <div class="exam-info-line">
                    <p class="exam-meta"><strong>Questions : </strong> {{ exam.questions.count }}</p>
                    <p class="exam-meta"><strong>Duration :</strong> {{ exam.duration_minutes }} minutes</p>
                </div>
                <div class="exam-info-line">
                    <p class="exam-meta"><strong>Date :</strong> {{ exam.date }}</p>
                    <p class="exam-meta"><strong>Timing :</strong> {{ exam.start_time }}</p>
                </div>
            </div>

            {% with trainee_exam=trainee_exam_map|get_item:exam.id %}
                
                {% if exam.questions.count != exam.total_marks %}
                    <!-- ‚ùå Exam not ready -->
                    <button class="upload-btn" style="background-color:#d9f274; color: black;" disabled>
                        <span class="menu-link">Questions Uploading..</span>
                    </button>

                {% elif not exam.isActivate %}
                    <!-- ‚è≥ Not yet active -->
                    <button class="upload-btn" style="background-color: #d9f274; color:black ;" disabled>
                        <span class="menu-link">Exam Inactive</span>
                    </button>

                {% elif trainee_exam and trainee_exam.attended %}
                    <!-- ‚úÖ Already taken -->
                    <button class="upload-btn" style="background-color: rgb(36, 33, 33);" disabled>
                        <span class="menu-link">Exam Finished..!</span>
                    </button>

                {% else %}
                    <!-- üöÄ Start Exam -->
                    <!-- <button class="upload-btn">
                        <a href="{% url 'developer_trainee_start_exam' exam.id %}" class="menu-link">Start Exam</a>
                    </button> -->
                    <button type="button" class="upload-btn" id="startExamBtn" data-exam-id="{{ exam.id }}">
    <span class="menu-link">Start Exam</span>
</button>

                {% endif %}

            {% endwith %}

        </div>
    {% endfor %}
{% else %}
    <p style="text-align: center; color: white; background-color: #3d484e; width: 20%; padding: 5px; border-radius: 10px; margin: 0 auto;">
         Technical Exams not available...!
    </p>
{% endif %}



<hr style="background-color: black; width: 100%;">
<div class="section-title-bar">
      <h4>Practical  Exams</h4>
    </div>
   {% for question in questions %}
   
    <div class="exam-row">
      <div class="exam-info">
        <p class="exam-title">Practical Questions</p>
        <p class="exam-meta">Duration: 45 minutes</p>
        <p class="exam-meta">Marks: 100</p>
      </div>
      <button class="upload-btn"><a href="{{ question.question_pdf.url }}" target="_blank" class="menu-link">Download</a></button>


          {% if request.GET.submitted == 'true' %}
    <button class="upload-btn" disabled>Answer Submitted</button>
{% else %}
          <button class="upload-btn" id="openModalBtn">Upload Answer</button>
{% endif %}

    </div>


    <div id="modalOverlay" class="modal-overlay">
  <div class="modal-content">
    <span class="close-btn" id="closeModalBtn">&times;</span>

    <h2 class="modal-title">{{ question.course.name }}</h2>
    <p style="display: flex; justify-content: space-around; color: rgb(58, 91, 9);"><strong>{{ question.title }}</strong></p>
    
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      {{ form.as_p }}
       <input type="hidden" name="question_id" value="{{ question.id }}">
      <button type="submit" class="submit-btn">Submit Question</button>
    </form>
  </div>
</div>
 {% empty %}
                <p style="text-align: center; color: white;
    background-color: #3d484e;
    width: 20%; padding: 5px; border-radius: 10px;
    margin: 0 auto;"> Practical Exams not found...!</p>
{% endfor %} 
 </div>
</div>

<!-- Modal Overlay -->
<!-- Confirmation Modal -->
<div id="examModal" class="modal-overlay1">
    <div class="modal-box">
        <h2>Exam Instructions ‚ö†Ô∏è</h2>
        <p>Please read carefully before starting:</p>
        <ul style="text-align:left; font-size: 14px;">
            <li>‚ùå Do not refresh or close this page.</li>
            <br>
            <li>‚ùå Do not switch to another tab or window.</li>
                        <br>

            <!-- <li>‚ö†Ô∏è Violations will automatically submit your exam.</li>            <br> -->
             <li>‚ö†Ô∏è Press <b>Esc</b> ‚Äî this will automatically submit your exam.</li><br>


            <li>‚úÖ Click ‚ÄúAccept & Start Exam‚Äù to begin.</li>            <br>

        </ul>
        <div class="modal-actions">
            <button id="cancelExamBtn" class="cancel-btn">Cancel</button>
            <button id="acceptExamBtn" class="accept-btn" >Accept & Start Exam</button>
        </div>
    </div>
</div>





{% endblock %}
{% block extra_js %}
<script>

  
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll(".upload-btn").forEach(btn => {
        btn.addEventListener("click", function() {
            const examId = this.getAttribute("data-exam-id");
            document.getElementById("examModal").style.display = "flex";

             // ‚ùå Cancel button ‚Üí close modal
        cancelExamBtn.addEventListener("click", function() {
            examModal.style.display = "none";
        });

            // update accept button action dynamically
            document.getElementById("acceptExamBtn").onclick = function() {
                window.location.href = `/trainee/developer_trainee_start_exam/${examId}/`;
            };
        });
    });
});
</script>




{% endblock %}
